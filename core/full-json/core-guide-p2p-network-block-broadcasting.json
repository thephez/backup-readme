{
 "metadata": {
  "image": [],
  "title": "Block Broadcasting",
  "description": "When a miner discovers a new block, it broadcasts the new block to its peers using one of the methods described here.",
  "keywords": "",
  "robots": "index"
 },
 "api": {
  "method": "get",
  "url": "",
  "auth": "required",
  "results": {
   "codes": [
    {
     "status": 200,
     "language": "json",
     "code": "{}",
     "name": ""
    },
    {
     "status": 400,
     "language": "json",
     "code": "{}",
     "name": ""
    }
   ]
  },
  "params": []
 },
 "next": {
  "description": "",
  "pages": [
   {
    "type": "doc",
    "icon": "file-text-o",
    "name": "Transaction Broadcasting",
    "slug": "core-guide-p2p-network-transaction-broadcasting",
    "category": "Core Guides"
   }
  ]
 },
 "algolia": {
  "recordCount": 2,
  "publishPending": false,
  "translationFailure": false,
  "updatedAt": "2023-02-21T19:15:56.233Z"
 },
 "title": "Block Broadcasting",
 "icon": "",
 "updates": [],
 "type": "basic",
 "slug": "core-guide-p2p-network-block-broadcasting",
 "excerpt": "",
 "body": "When a <<glossary:miner>> discovers a new <<glossary:block>>, it broadcasts the new block to its <<glossary:peers>> using one of the following methods:\n\n* **<<glossary:Unsolicited Block Push>>:**\n  The miner sends a [`block` message](core-ref-p2p-network-data-messages#block) to each of its full node peers with the new block. The miner can reasonably bypass the standard relay method in this way because it knows none of its peers already have the just-discovered block.\n\n* **<<glossary:Standard Block Relay>>:**\n  The miner, acting as a standard relay node, sends an [`inv` message](core-ref-p2p-network-data-messages#inv) to each of its peers (both full node and SPV) with an inventory referring to the new block. The most common responses are:\n\n   * Each <<glossary:blocks-first>> (BF) peer that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block.\n\n   * Each <<glossary:headers-first>> (HF) peer that wants the block replies with a [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) containing the header hash of the highest-height header on its best header chain, and likely also some headers further back on the best header chain to allow <<glossary:fork>> detection. That message is immediately followed by a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block. By requesting headers first, a headers-first peer can refuse <<glossary:orphan blocks>> as described in the subsection below.\n\n   * Each <<glossary:Simplified Payment Verification>> (SPV) client that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) typically requesting a <<glossary:merkle block>>.\n\n   The miner replies to each request accordingly by sending the block in a [`block` message](core-ref-p2p-network-data-messages#block), one or more headers in a [`headers` message](core-ref-p2p-network-data-messages#headers), or the merkle block and transactions relative to the SPV client's <<glossary:bloom filter>> in a [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock) followed by zero or more [`tx` messages](core-ref-p2p-network-data-messages#tx).\n\nBy default, Dash Core broadcasts blocks using <<glossary:standard block relay>>, but it will accept blocks sent using either of the methods described above.\n\nFull nodes validate the received block and then advertise it to their peers using the standard block relay method described above.  The condensed table below highlights the operation of the messages described above (Relay, BF, HF, and SPV refer to the relay node, a <<glossary:blocks-first>> node, a <<glossary:headers-first>> node, and an <<glossary:SPV>> client; *any* refers to a node using any block retrieval method.)\n\n| **Message** | [inv message](core-ref-p2p-network-data-messages#inv)                                   | [getdata message](core-ref-p2p-network-data-messages#getdata)               | [getheaders message](core-ref-p2p-network-data-messages#getheaders)                                     | [headers message](core-ref-p2p-network-data-messages#headers)\n| --- | --- | --- | --- | --- |\n| **From\u2192To** | Relay\u2192_Any_                                            | BF\u2192Relay                                   | HF\u2192Relay                                                               | Relay\u2192HF\n| **Payload** | The inventory of the new block                         | The inventory of the new block             | One or more header hashes on the HF node's best header chain (BHC)     | Up to 2,000 headers connecting HF node's BHC to relay node's BHC\n| **Message** | [`block` message](core-ref-p2p-network-data-messages#block)                               | [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock)       | [`tx` message](core-ref-p2p-network-data-messages#tx)                                                     |\n| **From\u2192To** | Relay\u2192BF/HF                                            | Relay\u2192SPV                                  | Relay\u2192SPV                                                              |\n| **Payload** | The new block in [serialized format](core-ref-block-chain-serialized-blocks) | The new block filtered into a merkle block | Serialized transactions from the new block that match the bloom filter |\n\n# Orphan Blocks\n\nBlocks-first nodes may download <<glossary:orphan blocks>>---blocks whose previous <<glossary:block header>> hash field refers to a block header this node hasn't seen yet. In other words, orphan blocks have no known parent (unlike <<glossary:stale blocks>>, which have known parents but which aren't part of the best <<glossary:block chain>>).\n\n![Difference Between Orphan And Stale Blocks](https://dash-docs.github.io/img/dev/en-orphan-stale-definition.svg)\n\nWhen a <<glossary:blocks-first>> node downloads an orphan block, it will not validate it. Instead, it will send a [`getblocks` message](core-ref-p2p-network-data-messages#getblocks) to the node which sent the orphan block; the broadcasting node will respond with an [`inv` message](core-ref-p2p-network-data-messages#inv) containing <<glossary:inventories>> of any blocks the downloading node is missing (up to 500); the downloading node will request those blocks with a [`getdata` message](core-ref-p2p-network-data-messages#getdata); and the broadcasting node will send those blocks with a [`block` message](core-ref-p2p-network-data-messages#block). The downloading node will validate those blocks, and once the parent of the former orphan block has been validated, it will validate the former orphan block.\n\nHeaders-first nodes avoid some of this complexity by always requesting block headers with the [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) before requesting a block with the [`getdata` message](core-ref-p2p-network-data-messages#getdata). The broadcasting node will send a [`headers` message](core-ref-p2p-network-data-messages#headers) containing all the block headers (up to 2,000) it thinks the downloading node needs to reach the tip of the best header chain; each of those headers will point to its parent, so when the downloading node receives the [`block` message](core-ref-p2p-network-data-messages#block), the block shouldn't be an orphan block---all of its parents should be known (even if they haven't been validated yet). If, despite this, the block received in the [`block` message](core-ref-p2p-network-data-messages#block) is an orphan block, a headers-first node will discard it immediately.\n\n> \ud83d\udcd8\n>\n> Note: Orphan discarding does mean that headers-first nodes will ignore orphan blocks sent by miners in an unsolicited block push.",
 "order": 3,
 "isReference": false,
 "deprecated": false,
 "hidden": false,
 "sync_unique": "",
 "link_url": "",
 "link_external": false,
 "reusableContent": [],
 "previousSlug": "",
 "slugUpdatedAt": "2022-09-20T18:32:52.226Z",
 "revision": 3,
 "_id": "63f5176df91c7700118e77ea",
 "version": "63f5176df91c7700118e7825",
 "updatedAt": "2023-01-12T20:43:23.396Z",
 "createdAt": "2019-10-25T18:28:03.731Z",
 "project": "5daf2e65f4109c0040fd51e1",
 "user": "62b2101422da70001ee51d95",
 "parentDoc": "63f5176df91c7700118e77cc",
 "category": "63f5176df91c7700118e779e",
 "__v": 1,
 "pendingAlgoliaPublish": false,
 "isApi": false,
 "id": "63f5176df91c7700118e77ea",
 "body_html": "When a <<glossary:miner>> discovers a new <<glossary:block>>, it broadcasts the new block to its <<glossary:peers>> using one of the following methods:\n\n* **<<glossary:Unsolicited Block Push>>:**\n  The miner sends a [`block` message](core-ref-p2p-network-data-messages#block) to each of its full node peers with the new block. The miner can reasonably bypass the standard relay method in this way because it knows none of its peers already have the just-discovered block.\n\n* **<<glossary:Standard Block Relay>>:**\n  The miner, acting as a standard relay node, sends an [`inv` message](core-ref-p2p-network-data-messages#inv) to each of its peers (both full node and SPV) with an inventory referring to the new block. The most common responses are:\n\n   * Each <<glossary:blocks-first>> (BF) peer that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block.\n\n   * Each <<glossary:headers-first>> (HF) peer that wants the block replies with a [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) containing the header hash of the highest-height header on its best header chain, and likely also some headers further back on the best header chain to allow <<glossary:fork>> detection. That message is immediately followed by a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block. By requesting headers first, a headers-first peer can refuse <<glossary:orphan blocks>> as described in the subsection below.\n\n   * Each <<glossary:Simplified Payment Verification>> (SPV) client that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) typically requesting a <<glossary:merkle block>>.\n\n   The miner replies to each request accordingly by sending the block in a [`block` message](core-ref-p2p-network-data-messages#block), one or more headers in a [`headers` message](core-ref-p2p-network-data-messages#headers), or the merkle block and transactions relative to the SPV client's <<glossary:bloom filter>> in a [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock) followed by zero or more [`tx` messages](core-ref-p2p-network-data-messages#tx).\n\nBy default, Dash Core broadcasts blocks using <<glossary:standard block relay>>, but it will accept blocks sent using either of the methods described above.\n\nFull nodes validate the received block and then advertise it to their peers using the standard block relay method described above.  The condensed table below highlights the operation of the messages described above (Relay, BF, HF, and SPV refer to the relay node, a <<glossary:blocks-first>> node, a <<glossary:headers-first>> node, and an <<glossary:SPV>> client; *any* refers to a node using any block retrieval method.)\n\n| **Message** | [inv message](core-ref-p2p-network-data-messages#inv)                                   | [getdata message](core-ref-p2p-network-data-messages#getdata)               | [getheaders message](core-ref-p2p-network-data-messages#getheaders)                                     | [headers message](core-ref-p2p-network-data-messages#headers)\n| --- | --- | --- | --- | --- |\n| **From\u2192To** | Relay\u2192_Any_                                            | BF\u2192Relay                                   | HF\u2192Relay                                                               | Relay\u2192HF\n| **Payload** | The inventory of the new block                         | The inventory of the new block             | One or more header hashes on the HF node's best header chain (BHC)     | Up to 2,000 headers connecting HF node's BHC to relay node's BHC\n| **Message** | [`block` message](core-ref-p2p-network-data-messages#block)                               | [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock)       | [`tx` message](core-ref-p2p-network-data-messages#tx)                                                     |\n| **From\u2192To** | Relay\u2192BF/HF                                            | Relay\u2192SPV                                  | Relay\u2192SPV                                                              |\n| **Payload** | The new block in [serialized format](core-ref-block-chain-serialized-blocks) | The new block filtered into a merkle block | Serialized transactions from the new block that match the bloom filter |\n\n# Orphan Blocks\n\nBlocks-first nodes may download <<glossary:orphan blocks>>---blocks whose previous <<glossary:block header>> hash field refers to a block header this node hasn't seen yet. In other words, orphan blocks have no known parent (unlike <<glossary:stale blocks>>, which have known parents but which aren't part of the best <<glossary:block chain>>).\n\n![Difference Between Orphan And Stale Blocks](https://dash-docs.github.io/img/dev/en-orphan-stale-definition.svg)\n\nWhen a <<glossary:blocks-first>> node downloads an orphan block, it will not validate it. Instead, it will send a [`getblocks` message](core-ref-p2p-network-data-messages#getblocks) to the node which sent the orphan block; the broadcasting node will respond with an [`inv` message](core-ref-p2p-network-data-messages#inv) containing <<glossary:inventories>> of any blocks the downloading node is missing (up to 500); the downloading node will request those blocks with a [`getdata` message](core-ref-p2p-network-data-messages#getdata); and the broadcasting node will send those blocks with a [`block` message](core-ref-p2p-network-data-messages#block). The downloading node will validate those blocks, and once the parent of the former orphan block has been validated, it will validate the former orphan block.\n\nHeaders-first nodes avoid some of this complexity by always requesting block headers with the [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) before requesting a block with the [`getdata` message](core-ref-p2p-network-data-messages#getdata). The broadcasting node will send a [`headers` message](core-ref-p2p-network-data-messages#headers) containing all the block headers (up to 2,000) it thinks the downloading node needs to reach the tip of the best header chain; each of those headers will point to its parent, so when the downloading node receives the [`block` message](core-ref-p2p-network-data-messages#block), the block shouldn't be an orphan block---all of its parents should be known (even if they haven't been validated yet). If, despite this, the block received in the [`block` message](core-ref-p2p-network-data-messages#block) is an orphan block, a headers-first node will discard it immediately.\n\n> \ud83d\udcd8\n>\n> Note: Orphan discarding does mean that headers-first nodes will ignore orphan blocks sent by miners in an unsolicited block push."
}