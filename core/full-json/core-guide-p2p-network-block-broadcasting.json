{
 "metadata": {
  "keywords": "",
  "robots": "index",
  "description": "When a miner discovers a new block, it broadcasts the new block to its peers using one of the methods described here.",
  "title": "Block Broadcasting",
  "image": []
 },
 "mdx": {
  "altBody": "",
  "status": "rdmd"
 },
 "api": {
  "results": {
   "codes": [
    {
     "status": 200,
     "language": "json",
     "code": "{}",
     "name": ""
    },
    {
     "status": 400,
     "language": "json",
     "code": "{}",
     "name": ""
    }
   ]
  },
  "auth": "required",
  "params": [],
  "url": "",
  "method": "get"
 },
 "next": {
  "pages": [
   {
    "type": "doc",
    "icon": "file-text-o",
    "name": "Transaction Broadcasting",
    "slug": "core-guide-p2p-network-transaction-broadcasting",
    "category": "Core Guides"
   }
  ],
  "description": ""
 },
 "algolia": {
  "translationFailure": false,
  "publishPending": false,
  "recordCount": 2,
  "updatedAt": "2023-02-21T19:15:56.233Z"
 },
 "reusableContent": [],
 "_id": "63f5176df91c7700118e77ea",
 "version": "63f5176df91c7700118e7825",
 "updatedAt": "2023-01-12T20:43:23.396Z",
 "createdAt": "2019-10-25T18:28:03.731Z",
 "project": "5daf2e65f4109c0040fd51e1",
 "user": "62b2101422da70001ee51d95",
 "parentDoc": "63f5176df91c7700118e77cc",
 "category": "63f5176df91c7700118e779e",
 "updates": [],
 "link_external": false,
 "link_url": "",
 "sync_unique": "",
 "hidden": false,
 "isReference": false,
 "order": 3,
 "body": "When a <<glossary:miner>> discovers a new <<glossary:block>>, it broadcasts the new block to its <<glossary:peers>> using one of the following methods:\n\n* **<<glossary:Unsolicited Block Push>>:**\n  The miner sends a [`block` message](core-ref-p2p-network-data-messages#block) to each of its full node peers with the new block. The miner can reasonably bypass the standard relay method in this way because it knows none of its peers already have the just-discovered block.\n\n* **<<glossary:Standard Block Relay>>:**\n  The miner, acting as a standard relay node, sends an [`inv` message](core-ref-p2p-network-data-messages#inv) to each of its peers (both full node and SPV) with an inventory referring to the new block. The most common responses are:\n\n   * Each <<glossary:blocks-first>> (BF) peer that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block.\n\n   * Each <<glossary:headers-first>> (HF) peer that wants the block replies with a [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) containing the header hash of the highest-height header on its best header chain, and likely also some headers further back on the best header chain to allow <<glossary:fork>> detection. That message is immediately followed by a [`getdata` message](core-ref-p2p-network-data-messages#getdata) requesting the full block. By requesting headers first, a headers-first peer can refuse <<glossary:orphan blocks>> as described in the subsection below.\n\n   * Each <<glossary:Simplified Payment Verification>> (SPV) client that wants the block replies with a [`getdata` message](core-ref-p2p-network-data-messages#getdata) typically requesting a <<glossary:merkle block>>.\n\n   The miner replies to each request accordingly by sending the block in a [`block` message](core-ref-p2p-network-data-messages#block), one or more headers in a [`headers` message](core-ref-p2p-network-data-messages#headers), or the merkle block and transactions relative to the SPV client's <<glossary:bloom filter>> in a [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock) followed by zero or more [`tx` messages](core-ref-p2p-network-data-messages#tx).\n\nBy default, Dash Core broadcasts blocks using <<glossary:standard block relay>>, but it will accept blocks sent using either of the methods described above.\n\nFull nodes validate the received block and then advertise it to their peers using the standard block relay method described above.  The condensed table below highlights the operation of the messages described above (Relay, BF, HF, and SPV refer to the relay node, a <<glossary:blocks-first>> node, a <<glossary:headers-first>> node, and an <<glossary:SPV>> client; *any* refers to a node using any block retrieval method.)\n\n| **Message** | [inv message](core-ref-p2p-network-data-messages#inv)                                   | [getdata message](core-ref-p2p-network-data-messages#getdata)               | [getheaders message](core-ref-p2p-network-data-messages#getheaders)                                     | [headers message](core-ref-p2p-network-data-messages#headers)\n| --- | --- | --- | --- | --- |\n| **From\u2192To** | Relay\u2192_Any_                                            | BF\u2192Relay                                   | HF\u2192Relay                                                               | Relay\u2192HF\n| **Payload** | The inventory of the new block                         | The inventory of the new block             | One or more header hashes on the HF node's best header chain (BHC)     | Up to 2,000 headers connecting HF node's BHC to relay node's BHC\n| **Message** | [`block` message](core-ref-p2p-network-data-messages#block)                               | [`merkleblock` message](core-ref-p2p-network-data-messages#merkleblock)       | [`tx` message](core-ref-p2p-network-data-messages#tx)                                                     |\n| **From\u2192To** | Relay\u2192BF/HF                                            | Relay\u2192SPV                                  | Relay\u2192SPV                                                              |\n| **Payload** | The new block in [serialized format](core-ref-block-chain-serialized-blocks) | The new block filtered into a merkle block | Serialized transactions from the new block that match the bloom filter |\n\n# Orphan Blocks\n\nBlocks-first nodes may download <<glossary:orphan blocks>>---blocks whose previous <<glossary:block header>> hash field refers to a block header this node hasn't seen yet. In other words, orphan blocks have no known parent (unlike <<glossary:stale blocks>>, which have known parents but which aren't part of the best <<glossary:block chain>>).\n\n![Difference Between Orphan And Stale Blocks](https://dash-docs.github.io/img/dev/en-orphan-stale-definition.svg)\n\nWhen a <<glossary:blocks-first>> node downloads an orphan block, it will not validate it. Instead, it will send a [`getblocks` message](core-ref-p2p-network-data-messages#getblocks) to the node which sent the orphan block; the broadcasting node will respond with an [`inv` message](core-ref-p2p-network-data-messages#inv) containing <<glossary:inventories>> of any blocks the downloading node is missing (up to 500); the downloading node will request those blocks with a [`getdata` message](core-ref-p2p-network-data-messages#getdata); and the broadcasting node will send those blocks with a [`block` message](core-ref-p2p-network-data-messages#block). The downloading node will validate those blocks, and once the parent of the former orphan block has been validated, it will validate the former orphan block.\n\nHeaders-first nodes avoid some of this complexity by always requesting block headers with the [`getheaders` message](core-ref-p2p-network-data-messages#getheaders) before requesting a block with the [`getdata` message](core-ref-p2p-network-data-messages#getdata). The broadcasting node will send a [`headers` message](core-ref-p2p-network-data-messages#headers) containing all the block headers (up to 2,000) it thinks the downloading node needs to reach the tip of the best header chain; each of those headers will point to its parent, so when the downloading node receives the [`block` message](core-ref-p2p-network-data-messages#block), the block shouldn't be an orphan block---all of its parents should be known (even if they haven't been validated yet). If, despite this, the block received in the [`block` message](core-ref-p2p-network-data-messages#block) is an orphan block, a headers-first node will discard it immediately.\n\n> \ud83d\udcd8\n>\n> Note: Orphan discarding does mean that headers-first nodes will ignore orphan blocks sent by miners in an unsolicited block push.",
 "excerpt": "",
 "slug": "core-guide-p2p-network-block-broadcasting",
 "type": "basic",
 "title": "Block Broadcasting",
 "__v": 1,
 "pendingAlgoliaPublish": false,
 "deprecated": false,
 "icon": "",
 "previousSlug": "",
 "revision": 3,
 "slugUpdatedAt": "2022-09-20T18:32:52.226Z",
 "isApi": false,
 "id": "63f5176df91c7700118e77ea",
 "body_html": "<p>When a <span class=\"GlossaryItem-trigger\">miner</span> discovers a new <span class=\"GlossaryItem-trigger\">block</span>, it broadcasts the new block to its <span class=\"GlossaryItem-trigger\">peers</span> using one of the following methods:</p>\n<ul>\n<li>\n<p><strong>&lt;&lt;glossary:Unsolicited Block Push&gt;&gt;:</strong><br/>\nThe miner sends a <a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a> to each of its full node peers with the new block. The miner can reasonably bypass the standard relay method in this way because it knows none of its peers already have the just-discovered block.</p>\n</li>\n<li>\n<p><strong>&lt;&lt;glossary:Standard Block Relay&gt;&gt;:</strong><br/>\nThe miner, acting as a standard relay node, sends an <a href=\"core-ref-p2p-network-data-messages#inv\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">inv</code> message</a> to each of its peers (both full node and SPV) with an inventory referring to the new block. The most common responses are:</p>\n<ul>\n<li>\n<p>Each <span class=\"GlossaryItem-trigger\">blocks-first</span> (BF) peer that wants the block replies with a <a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getdata</code> message</a> requesting the full block.</p>\n</li>\n<li>\n<p>Each <span class=\"GlossaryItem-trigger\">headers-first</span> (HF) peer that wants the block replies with a <a href=\"core-ref-p2p-network-data-messages#getheaders\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getheaders</code> message</a> containing the header hash of the highest-height header on its best header chain, and likely also some headers further back on the best header chain to allow <span class=\"GlossaryItem-trigger\">fork</span> detection. That message is immediately followed by a <a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getdata</code> message</a> requesting the full block. By requesting headers first, a headers-first peer can refuse &lt;&lt;glossary:orphan blocks&gt;&gt; as described in the subsection below.</p>\n</li>\n<li>\n<p>Each &lt;&lt;glossary:Simplified Payment Verification&gt;&gt; (SPV) client that wants the block replies with a <a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getdata</code> message</a> typically requesting a &lt;&lt;glossary:merkle block&gt;&gt;.</p>\n</li>\n</ul>\n<p>The miner replies to each request accordingly by sending the block in a <a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a>, one or more headers in a <a href=\"core-ref-p2p-network-data-messages#headers\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">headers</code> message</a>, or the merkle block and transactions relative to the SPV client&#x27;s &lt;&lt;glossary:bloom filter&gt;&gt; in a <a href=\"core-ref-p2p-network-data-messages#merkleblock\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">merkleblock</code> message</a> followed by zero or more <a href=\"core-ref-p2p-network-data-messages#tx\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">tx</code> messages</a>.</p>\n</li>\n</ul>\n<p>By default, Dash Core broadcasts blocks using &lt;&lt;glossary:standard block relay&gt;&gt;, but it will accept blocks sent using either of the methods described above.</p>\n<p>Full nodes validate the received block and then advertise it to their peers using the standard block relay method described above.  The condensed table below highlights the operation of the messages described above (Relay, BF, HF, and SPV refer to the relay node, a <span class=\"GlossaryItem-trigger\">blocks-first</span> node, a <span class=\"GlossaryItem-trigger\">headers-first</span> node, and an <span class=\"GlossaryItem-trigger\">SPV</span> client; <em>any</em> refers to a node using any block retrieval method.)</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<div class=\"rdmd-table\"><div class=\"rdmd-table-inner\"><table><thead><tr><th><strong>Message</strong></th><th><a href=\"core-ref-p2p-network-data-messages#inv\" target=\"\" title=\"\">inv message</a></th><th><a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\">getdata message</a></th><th><a href=\"core-ref-p2p-network-data-messages#getheaders\" target=\"\" title=\"\">getheaders message</a></th><th><a href=\"core-ref-p2p-network-data-messages#headers\" target=\"\" title=\"\">headers message</a></th></tr></thead><tbody><tr><td><strong>From\u2192To</strong></td><td>Relay\u2192<em>Any</em></td><td>BF\u2192Relay</td><td>HF\u2192Relay</td><td>Relay\u2192HF</td></tr><tr><td><strong>Payload</strong></td><td>The inventory of the new block</td><td>The inventory of the new block</td><td>One or more header hashes on the HF node&#x27;s best header chain (BHC)</td><td>Up to 2,000 headers connecting HF node&#x27;s BHC to relay node&#x27;s BHC</td></tr><tr><td><strong>Message</strong></td><td><a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a></td><td><a href=\"core-ref-p2p-network-data-messages#merkleblock\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">merkleblock</code> message</a></td><td><a href=\"core-ref-p2p-network-data-messages#tx\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">tx</code> message</a></td><td></td></tr><tr><td><strong>From\u2192To</strong></td><td>Relay\u2192BF/HF</td><td>Relay\u2192SPV</td><td>Relay\u2192SPV</td><td></td></tr><tr><td><strong>Payload</strong></td><td>The new block in <a href=\"core-ref-block-chain-serialized-blocks\" target=\"\" title=\"\">serialized format</a></td><td>The new block filtered into a merkle block</td><td>Serialized transactions from the new block that match the bloom filter</td><td></td></tr></tbody></table></div></div>\n<h1 class=\"heading heading-1 header-scroll\" align=\"\"><div class=\"heading-anchor anchor waypoint\" id=\"orphan-blocks\"></div><div class=\"heading-text\"><div id=\"section-orphan-blocks\" class=\"heading-anchor_backwardsCompatibility\"></div>Orphan Blocks</div><a aria-label=\"Skip link to Orphan Blocks\" class=\"heading-anchor-icon fa fa-anchor\" href=\"#orphan-blocks\"></a></h1>\n<p>Blocks-first nodes may download &lt;&lt;glossary:orphan blocks&gt;&gt;---blocks whose previous &lt;&lt;glossary:block header&gt;&gt; hash field refers to a block header this node hasn&#x27;t seen yet. In other words, orphan blocks have no known parent (unlike &lt;&lt;glossary:stale blocks&gt;&gt;, which have known parents but which aren&#x27;t part of the best &lt;&lt;glossary:block chain&gt;&gt;).</p>\n<p><span aria-label=\"Difference Between Orphan And Stale Blocks\" class=\"img lightbox closed\" role=\"button\" tabindex=\"0\"><span class=\"lightbox-inner\"><img alt=\"Difference Between Orphan And Stale Blocks\" loading=\"lazy\" src=\"https://dash-docs.github.io/img/dev/en-orphan-stale-definition.svg\" align=\"\" caption=\"\" height=\"auto\" title=\"\" width=\"auto\"/></span></span></p>\n<p>When a <span class=\"GlossaryItem-trigger\">blocks-first</span> node downloads an orphan block, it will not validate it. Instead, it will send a <a href=\"core-ref-p2p-network-data-messages#getblocks\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getblocks</code> message</a> to the node which sent the orphan block; the broadcasting node will respond with an <a href=\"core-ref-p2p-network-data-messages#inv\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">inv</code> message</a> containing <span class=\"GlossaryItem-trigger\">inventories</span> of any blocks the downloading node is missing (up to 500); the downloading node will request those blocks with a <a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getdata</code> message</a>; and the broadcasting node will send those blocks with a <a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a>. The downloading node will validate those blocks, and once the parent of the former orphan block has been validated, it will validate the former orphan block.</p>\n<p>Headers-first nodes avoid some of this complexity by always requesting block headers with the <a href=\"core-ref-p2p-network-data-messages#getheaders\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getheaders</code> message</a> before requesting a block with the <a href=\"core-ref-p2p-network-data-messages#getdata\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">getdata</code> message</a>. The broadcasting node will send a <a href=\"core-ref-p2p-network-data-messages#headers\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">headers</code> message</a> containing all the block headers (up to 2,000) it thinks the downloading node needs to reach the tip of the best header chain; each of those headers will point to its parent, so when the downloading node receives the <a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a>, the block shouldn&#x27;t be an orphan block---all of its parents should be known (even if they haven&#x27;t been validated yet). If, despite this, the block received in the <a href=\"core-ref-p2p-network-data-messages#block\" target=\"\" title=\"\"><button aria-label=\"Copy Code\" class=\"rdmd-code-copy fa\"></button><code class=\"rdmd-code lang- theme-light\" data-lang=\"\" name=\"\" tabindex=\"0\">block</code> message</a> is an orphan block, a headers-first node will discard it immediately.</p>\n<blockquote class=\"callout callout_info\" theme=\"\ud83d\udcd8\"><h2 class=\"callout-heading empty\"><span class=\"callout-icon\">\ud83d\udcd8</span></h2><p>Note: Orphan discarding does mean that headers-first nodes will ignore orphan blocks sent by miners in an unsolicited block push.</p></blockquote>"
}